{% extends "_layout.html" %}
{% block title %}Me{% endblock %}
{% block content %}
  <div class="card">
    <h1>My account</h1>
    {% if user %}
      <dl class="dl">
        <dt>Email</dt><dd>{{ user.email }}</dd>
        <dt>Active</dt><dd>{{ "yes" if user.is_active else "no" }}</dd>
        <dt>Roles</dt><dd>{% if role_keys %}{{ role_keys|join(", ") }}{% else %}<span class="muted">â€”</span>{% endif %}</dd>
        <dt>Permission count</dt><dd>{{ perm_keys|length }}</dd>
      </dl>

      <div style="height: 10px;"></div>
      <div class="card">
        <h2 style="margin-top:0;">Rep Address</h2>
        <form class="form" method="post" action="{{ url_for('admin.me_update') }}" style="max-width:520px;">
          <div>
            <div class="label">Address 1</div>
            <input name="address1" value="{{ user.address1|default('')|e }}" />
          </div>
          <div>
            <div class="label">Address 2</div>
            <input name="address2" value="{{ user.address2|default('')|e }}" />
          </div>
          <div class="grid" style="grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
            <div>
              <div class="label">City</div>
              <input name="city" value="{{ user.city|default('')|e }}" />
            </div>
            <div>
              <div class="label">State</div>
              <input name="state" value="{{ user.state|default('')|e }}" />
            </div>
            <div>
              <div class="label">ZIP</div>
              <input name="zip" value="{{ user.zip|default('')|e }}" pattern="\\d{5}(-\\d{4})?" placeholder="12345 or 12345-6789" />
            </div>
          </div>
          <div style="display:flex; gap:10px; margin-top:8px;">
            <button class="button" type="submit">Save</button>
          </div>
        </form>
      </div>

      <div style="height: 10px;"></div>
      <div class="card">
        <h2 style="margin-top:0;">Permissions (first 40)</h2>
        {% if perm_keys %}
          <ul style="margin:0; padding-left: 18px;">
            {% for k in perm_keys[:40] %}
              <li><code>{{ k|e }}</code></li>
            {% endfor %}
          </ul>
          {% if perm_keys|length > 40 %}
            <p class="muted" style="margin-top:10px;">Showing 40 of {{ perm_keys|length }}.</p>
          {% endif %}
        {% else %}
          <p class="muted">No permissions found for this user.</p>
        {% endif %}
      </div>
    {% else %}
      <p class="muted">No current user.</p>
    {% endif %}
  </div>
{% endblock %}

