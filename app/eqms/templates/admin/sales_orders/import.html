{% extends "_layout.html" %}
{% block title %}Import Sales Orders PDF{% endblock %}
{% block content %}
<div class="card">
    <h1 style="margin-top:0;">Import Sales Orders (PDF)</h1>
    <p class="muted">Upload a 2025 Sales Orders PDF to import orders, lines, and linked distributions.</p>
    
    <div style="display:flex; gap:10px; margin-bottom:16px;">
        <a class="button button--secondary" href="{{ url_for('rep_traceability.sales_orders_list') }}">&larr; Back to List</a>
    </div>
</div>

<div style="height: 14px;"></div>

<div class="card">
    {% if pdfplumber_available %}
    <h2 style="margin-top:0;">Upload PDF</h2>
    <form class="form" method="post" enctype="multipart/form-data">
        <div>
            <div class="label">PDF File</div>
            <input type="file" name="pdf_file" accept=".pdf,application/pdf" required />
            <p class="muted" style="margin-top:4px; font-size:12px;">
                Supports table extraction from structured PDF files.
            </p>
        </div>
        <button class="button" type="submit">Import PDF</button>
    </form>
    {% else %}
    <div class="alert alert--danger">
        <strong>Error:</strong> PDF parsing library (<code>pdfplumber</code>) is not installed.
        Install it via <code>pip install pdfplumber</code> to enable PDF import.
    </div>
    {% endif %}
</div>

<div style="height: 14px;"></div>

<div class="card">
    <h3 style="margin-top:0;">Expected Format</h3>
    <p class="muted">The PDF should contain tables with the following columns:</p>
    <ul style="margin:8px 0; padding-left:20px;">
        <li><strong>Order Number</strong> — Unique order identifier</li>
        <li><strong>Date</strong> — Order date (MM/DD/YYYY or YYYY-MM-DD)</li>
        <li><strong>Customer</strong> — Facility/company name</li>
        <li><strong>SKU</strong> — Product SKU (14Fr, 16Fr, 18Fr, etc.)</li>
        <li><strong>Quantity</strong> — Number of units</li>
        <li><strong>Lot Number</strong> (optional) — Lot identifier</li>
    </ul>
</div>

<div style="height: 14px;"></div>

<div class="card">
    <h3 style="margin-top:0;">Import Notes</h3>
    <ul style="margin:8px 0; padding-left:20px;">
        <li>Sales orders created with <code>source="pdf_import"</code></li>
        <li>Order lines created for each SKU/quantity combination</li>
        <li><strong>Distribution log entries</strong> automatically created and linked to sales orders</li>
        <li>Customers auto-created or matched by facility name</li>
        <li>Duplicate orders (same order number + date) skipped</li>
        <li>Parse errors reported but won't stop the import</li>
    </ul>
</div>
{% endblock %}
